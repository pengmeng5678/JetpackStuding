# 中智零售机器人交互协议

## 修订记录

| 修订日期   | 版本    | 内容                                                         |
| ---------- | ------- | ------------------------------------------------------------ |
| 2022-02-22 | v1.0.0  | 制定初始内容                                                 |
| 2022-03-24 | v1.0.1 | 修改协议格式 |
| 2022-04-06 | v1.0.2 | 根据产品原型确定数据协议 |
| 2022-05-05 | v1.0.3 | 修改对接方案 |
| 2022-05-07 | v1.0.4 | 修正数据字段 |
| 2022-05-09 | v1.0.5 | 调整文档描述顺序 |
| 2022-05-09 | v1.0.6 | 意图对应数据结构 |
| 2022-05-10 | v1.0.7 | 新增商品大类和页面类型字段 |

## 1.对话接口

### 1.1基础数据



#### 1.1.1产品字段(待确认)

| 字段名              | 数据类型 | 说明                                    |
| ------------------- | -------- | --------------------------------------- |
| merchant_id         | Integer  | 商家ID                                  |
| prod_id             | Integer  | 产品ID                                  |
| prod_title          | String   | 标题                                    |
| prod_desc           | String   | 简介                                    |
| prod_poster_pic_url | String   | 产品海报图片                            |
| prod_full_pic_url   | String   | 产品完整图片                            |
| prod_front_pic_url  | String   | 产品正面图片                            |
| prod_back_pic_url   | String   | 产品背面图片                            |
| prod_video_url      | String   | 产品视频                                |
| original_price      | Double   | 原价                                    |
| current_price       | Double   | 现价                                    |
| memory              | String[] | 内存                                    |
| color               | String[] | 颜色                                    |
| spec                | Object   | 规格                                    |
| is_activity         | Boolean  | 是否超级折扣类目  是：true    否：false |



#### 1.1.2规格字段(待确认)

| 字段名        | 数据类型 | 说明     |
| ------------- | -------- | -------- |
| length        | String   | 长度     |
| width         | String   | 宽度     |
| thickness     | String   | 厚度     |
| weight        | String   | 重量     |
| size          | String   | 尺寸     |
| hue           | String   | 色彩     |
| type          | String   | 类型     |
| hvga          | String   | 分辨率   |
| pixel_density | String   | 像素密度 |
| cpu_brand     | String   | CPU品牌  |



* 举例

  ```json
  {
      "prod_id": "1",
      "prod_title": "HUAWEI P40",
      "prod_desc": "HUAWEI P40 屏幕90Hz刷新率， 畅快流动的显示",
      "prod_poster_pic_url": "http://www.xxx.com/xxx1.png",
      "prod_full_pic_url": "http://www.xxx.com/xxx2.png",
      "prod_front_pic_url": "http://www.xxx.com/xxx3.png",
      "prod_back_pic_url": "http://www.xxx.com/xxx4.png",
      "prod_video_url": "http://www.xxx.com/xxx.mp4",
      "original_price": 4598.00,
      "current_price": 3845.00,
      "memory": [{"mem_id":1, "mem_name":"12G+256G"}, {"mem_id":2, "mem_name":"12G+512G"}, {"mem_id":3, "mem_name":"8G+128G"}],
      "color": [{"color_id":1, "color_val":"#ffffff", "color_name":"蓝色"}, {"color_id":2, "color_val":"#ffffff","color_name":"黑色"}]
  }
  ```





#### 1.1.3产品类型字段(待确认)

| 字段名    | 数据类型 | 说明     |
| --------- | -------- | -------- |
| cate_id   | Integer  | 系列ID   |
| cate_name | String   | 产品系列 |
| cate_desc | String   | 系列简介 |
| cate_pic  | String   | 产品图片 |



#### 1.1.4颜色字段(待确认)

| 字段名      | 数据类型 | 说明   |
| ----------- | -------- | ------ |
| color_id    | Integer  | 颜色ID |
| color_name  | String   | 颜色名 |
| color_value | String   | 颜色值 |



#### 1.1.5推荐产品表(待确认)

| 字段名      | 数据类型 | 说明   |
| ----------- | -------- | ------ |
| merchant_id | Integer  | 商家ID |
| prod_id     | Integer  | 产品ID |



#### 1.1.6活动字段(待确认)

| 字段名             | 数据类型 | 说明     |
| ------------------ | -------- | -------- |
| merchant_id        | Integer  | 商家ID   |
| prod_id            | Integer  | 产品ID   |
| activity_id        | Integer  | 活动ID   |
| activity_name      | String   | 活动名称 |
| activity_time      | String   | 活动时间 |
| activity_desc      | String   | 活动介绍 |
| activity_small_pic | String   | 缩略图   |
| activity_big_pic   | String   | 活动海报 |


### 1.2意图、QA问答

>* **Request Method:** POST
>* **Path:** /api/zz/chat

#### 请求参数

| 参数名    | 类型   | 描述                                     | 必须 |
| --------- | ------ | ---------------------------------------- | ---- |
| appKey    | String | 业务appkey                               | 是   |
| msg       | String | 用户发送的消息                           | 是   |
| clientId  | String | **机器人唯一ID, (格式： 设备ID_版本号)** | 是   |
| extraInfo | Object | 透传扩展信息                             | 否   |


#### 请求示例

```json
{
    "appKey": "zz-robot-test",
    "clientId": "D267E5953984B555FF99EF4E8C16E1DA_12",
    "msg": "有华为手机吗？",
    "extraOrderInfo": {
        "userId": "5415"
    }
}
```

#### 响应参数

| 参数名  | 类型    | 描述                                      | 必须 |
| ------- | ------- | ----------------------------------------- | ---- |
| retcode | Integer | 接口调用返回值（0代表成功，其他均为失败） | 是   |
| ask     | String  | 用户询问                                  | 是   |
| msg     | String  | 给用户返回的话术                          | 是   |
| data    | JSON    | 给前端返回的结构化数据，无数据时为{}      | 是   |
| verify  | String  | 验证串                                    | 否   |
| elapsed | String  | 查询的耗时                                | 否   |

#### 响应示例

```json
{
    "retcode":0,
    "ask":"有华为手机吗？",
    "msg":"",
    "verify":"e8908dd914a0106767dc86a31a7a96e5",
    "elapsed":0.5530591011047363,
    "data":{
        "code":1,
        "chatKey":"zz-robot-test-xx",
        "service":"OTHER",
        "task_finished":false,
        "skill_rejection":false,
        "result":{
            "actionDesc":"搜索意图",
            "comCategory":"mobilePhone",
            "pageType":"prod_introduction",
            "reply":"返回话术",
            "action":"10009",
            "data":[
                {
                    "prod_id":"1"
                },
                {
                    "prod_id":"2"
                },
                {
                    "prod_id":"3"
                },
                {
                    "prod_id":"4"
                }
            ]
        }
    }
}
```



#### data中result字段说明

| 字段       | 数据类型 | 说明                 |
| ---------- | -------- | --------------------|
| reply      | String   | 返回话术             |
| action     | String   | 具体意图（详见下表）  |
| actionDesc | String   | 具体意图描述         |
| comCategory| String   | 商品大类(如手机/汽车/家电) |
| pageType   | String   | 页面类型(如产品介绍) |
| data       | Object   | 数据体              |

#### result中comCategory字段说明
| 字段名             | 数据类型 | 说明      |
| ------------------ | -------- | --------|
| mobilePhone        | String   | 手机 |
| automobile         | String   | 汽车 |

#### result中pageType字段说明

| 字段名             | 数据类型 | 说明      |
| ------------------ | -------- | --------|
| prod_recomm        | String   | 产品推荐 |
| prod_type          | String   | 产品类型 |
| prod_list          | String   | 弹出列表 |
| func_introduction  | String   | 功能介绍 |
| price_introduction | String   | 价格介绍 |
| activity_introduction      | String   | 活动介绍 |
| prod_introduction  | String   | 产品介绍 |
| param_introduction | String   | 参数介绍 |

#### result中action具体意图说明（补充对应数据结构）

| 字段值 | 说明           | 对应数据结构 |
| ------ | -------------- | ------------ |
| 10000  | 未识别         | 指令数据结构 |
| 10001  | 表达肯定       | 指令数据结构 |
| 10002  | 表达否定       | 指令数据结构 |
| 10003  | 表达更换       | 指令数据结构 |
| 10004  | 表达重复       | 指令数据结构 |
| 10005  | 表达退出       | 指令数据结构 |
| 10006  | 音量调大       | 指令数据结构 |
| 10007  | 音量调小       | 指令数据结构 |
| 10008  | 咨询意图       | 产品数据结构 |
| 10009  | 搜索意图       | 产品数据结构 |
| 10010  | 购买意图       | 指令数据结构 |
| 10011  | 查询品类       | 系列数据结构 |
| 10012  | 查询系列       | 系列数据结构 |
| 10013  | 查询产品型号   | 指令数据结构 |
| 10014  | 查询品牌       | 指令数据结构 |
| 10015  | 查一级外观     | 指令数据结构 |
| 10016  | 查一级处理器   | 指令数据结构 |
| 10017  | 查一级内存     | 指令数据结构 |
| 10018  | 查一级系统     | 指令数据结构 |
| 10019  | 查一级游戏     | 指令数据结构 |
| 10020  | 查一级拍摄     | 指令数据结构 |
| 10021  | 查一级屏幕     | 指令数据结构 |
| 10022  | 查一级充电     | 指令数据结构 |
| 10023  | 查一级上市时间 | 指令数据结构 |
| 10024  | 查一级交互体验 | 指令数据结构 |
| 10025  | 查规格         | 产品数据结构 |
| 10026  | 查询活动       | 活动数据结构 |
| 10027  | 查询新品       | 产品数据结构 |
| 10028  | 查询折扣       | 指令数据结构 |
| 10029  | 查询优惠       | 指令数据结构 |
| 10030  | 查询价格       | 指令数据结构 |
| 10031  | 请求带路       | 指令数据结构 |
| 10032  | 错误路径       | 指令数据结构 |
| 10033  | 询问位置       | 指令数据结构 |
| 10034  | 询问名字       | 指令数据结构 |
| 10035  | 询问库存       | 指令数据结构 |
| 10036  | 询问批评       | 指令数据结构 |
| 10037  | 询问用途       | 指令数据结构 |
| 10038  | 询问能力       | 指令数据结构 |
| 10039  | 询问夸奖       | 指令数据结构 |
| 10040  | 询问上班       | 指令数据结构 |
| 10041  | 下一个         | 指令数据结构 |



#### 数据结构

*  产品推荐数据结构

    ```json
    {
        "code":1,
        "chatKey":"zz-robot-test-xx",
        "service":"OTHER",
        "task_finished":false,
        "skill_rejection":false,
        "result":{
            "actionDesc":"搜索意图",
            "comCategory":"mobilePhone",
            "pageType":"prod_recomm",
            "reply":"返回话术",
            "guide":["介绍一下","查看产品类型"],
            "action":"10009",
            "data":[
                {"prod_id": "1"}, {"prod_id": "2"}, {"prod_id": "3"}, {"prod_id": "4"}
            ]
        }
    }
    ```

    

* 产品类型(系列)数据结构

    ```json
    {
        "code":1,
        "chatKey":"zz-robot-test-xx",
        "service":"OTHER",
        "task_finished":false,
        "skill_rejection":false,
        "result":{
            "actionDesc":"查询系列",
            "comCategory":"mobilePhone",
            "pageType":"prod_type",
            "reply":"返回话术",
            "action":"10012",
            "data":[
                {
                    "cate_id": "1",
                    "cate_name": "P系列",
                    "cate_desc": "颜值出众， 摄影服众",
                    "cate_pic": "http://www.xxx.com/xxx1.png"
                }
            ]
        }
    }
    ```

     

* 活动数据结构

    ```json
    {
        "code": 1,
        "chatKey": "zz-robot-test-xx", 
        "service": "OTHER",
        "task_finished": false,
        "skill_rejection": false,
        "result": {
          "actionDesc": "指引结束",
          "comCategory":"mobilePhone",
          "pageType":"activity_introduction",
          "reply":"返回话术",
          "action":"ACTIVITY",
          "data":[
                {"activity_id":1, "activity_big_pic":"http://www.xxx.com/xx.png"}
            ]
        }
    }
    ```



* 指令数据结构

    ```json
    {
        "code":1,
        "chatKey":"zz-robot-test-xx",
        "service":"OTHER",
        "task_finished":false,
        "skill_rejection":false,
        "result":{
            "actionDesc":"下一个",
            "reply":"返回话术",
            "action":"10041"
        }
    }
    ```





### 1.3获取引导选项

>* **Request Method:** POST
>* **Path:** /api/page/guide

#### 请求参数

| 参数名 | 类型   | 描述     | 必须 |
| ------ | ------ | -------- | ---- |
| name   | String | 页面名称 | Y    |

#### 返回参数

| 参数名  | 类型    | 描述           | 必须 |
| ------- | ------- | -------------- | ---- |
| message | String  | 错误消息       | Y    |
| status  | Integer | 状态码         | Y    |
| payload | String  | 数据体（json） | Y    |


#### 请求示例

`/api/page`/guide

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "[
    	\"1000元以上手机\",
		\"了解外观设计\"
        ]",
    "retcode": 0
}
```







### 1.4获取产品详情

>* **Request Method:** GET
>* **Path:** /api/prod/{prod_id}

#### 请求参数

| 参数名  | 类型 | 描述   | 必须 |
| ------- | ---- | ------ | ---- |
| prod_id | int  | 产品ID | Y    |

#### 返回参数

| 参数名  | 类型    | 描述           | 必须 |
| ------- | ------- | -------------- | ---- |
| message | String  | 错误消息       | Y    |
| status  | Integer | 状态码         | Y    |
| payload | String  | 数据体（json） | Y    |


#### 请求示例

`/api/prod`/1

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{
            \"prod_id\\": \"1\",
            \"prod_title\": \"HUAWEI P40\",
            \"prod_desc\": \"HUAWEI P40 屏幕90Hz刷新率， 畅快流动的显示\",
            \"prod_poster_pic_url\": \"http://www.xxx.com/xxx1.png\",
            \"prod_full_pic_url\": \"http://www.xxx.com/xxx2.png\",
            \"prod_front_pic_url\": \"http://www.xxx.com/xxx3.png\",
            \"prod_back_pic_url\": \"http://www.xxx.com/xxx4.png\",
            \"prod_video_url\": \"http://www.xxx.com/xxx.mp4\",
            \"original_price\": 4598.00,
            \"current_price\": 3845.00,
            \"memory\": [{\"mem_id\":1, \"mem_name\":\"12G+256G\"}, {\"mem_id\":2, \"mem_name\":\"12G+512G\"}, {\"mem_id\":3, \"mem_name\":\"8G+128G\"}],
            \"color\": [{\"color_id\":1, \"color_val\":\"#ffffff\", \"color_name\":\"蓝色\"}, {\"color_id\":2, \"color_val\":\"#ffffff\",\"color_name\":\"黑色\"}]
        }",
    "retcode": 0
}
```

## 





## 2.产品管理

### 2.1新增产品

>* **Request Method:** POST 
>* **Path:** /api/prod

#### 请求参数

| 参数名 | 类型 | 描述 | 必须 |
| ------ | ---- | ---- | ---- |
|        |      |      |      |

#### 返回参数

| 参数名  | 类型    | 描述     | 必须 |
| ------- | ------- | -------- | ---- |
| message | String  | 错误消息 | Y    |
| status  | Integer | 状态码   | Y    |
|         |         |          |      |


#### 请求示例

`/api/prod`

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

## 

### 2.2更新产品

>* **Request Method:** PUT
>* **Path:** /api/prod

#### 请求参数

| 参数名 | 类型 | 描述 | 必须 |
| ------ | ---- | ---- | ---- |
|        |      |      |      |

#### 返回参数

| 参数名  | 类型    | 描述     | 必须 |
| ------- | ------- | -------- | ---- |
| message | String  | 错误消息 | Y    |
| status  | Integer | 状态码   | Y    |
|         |         |          |      |


#### 请求示例

`/api/prod`

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

## 

### 2.3删除产品

>* **Request Method:** DELETE
>* **Path:** /api/prod/{prod_id}

#### 新增产品

| 参数名  | 类型    | 描述   | 必须 |
| ------- | ------- | ------ | ---- |
| prod_id | Integer | 产品ID | Y    |

#### 返回参数

| 参数名  | 类型    | 描述     | 必须 |
| ------- | ------- | -------- | ---- |
| message | String  | 错误消息 | Y    |
| status  | Integer | 状态码   | Y    |
|         |         |          |      |


#### 请求示例

`/api/prod`/1

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

## 



## 3.FAQ管理

### 3.1新增FAQ

>* **Request Method:** POST 
>* **Path:** /api/faq

#### 请求参数

| 参数名 | 类型 | 描述 | 必须 |
| ------ | ---- | ---- | ---- |
|        |      |      |      |

#### 返回参数

| 参数名 | 类型    | 描述     | 必须 |
| ------ | ------- | -------- | ---- |
| msg    | String  | 错误消息 | Y    |
| code   | Integer | 状态码   | Y    |
|        |         |          |      |


#### 请求示例

`/api/faq`

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

### 3.2更新FAQ

>* **Request Method:** PUT
>* **Path:** /api/faq

#### 请求参数

| 参数名 | 类型 | 描述 | 必须 |
| ------ | ---- | ---- | ---- |
|        |      |      |      |

#### 返回参数

| 参数名 | 类型    | 描述     | 必须 |
| ------ | ------- | -------- | ---- |
| msg    | String  | 错误消息 | Y    |
| code   | Integer | 状态码   | Y    |
|        |         |          |      |


#### 请求示例

`/api/faq`

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

## 

### 3.3删除FAQ

>* **Request Method:** DELETE
>* **Path:** /api/faq/{faq_id}

#### 请求参数

| 参数名 | 类型    | 描述   | 必须 |
| ------ | ------- | ------ | ---- |
| faq_id | Integer | FAQ ID | Y    |

#### 返回参数

| 参数名 | 类型    | 描述     | 必须 |
| ------ | ------- | -------- | ---- |
| msg    | String  | 错误消息 | Y    |
| code   | Integer | 状态码   | Y    |
|        |         |          |      |


#### 请求示例

`/api/faq/1`

#### 返回数据

```json
{
    "message": "ok",
    "status": 200,
    "payload": "{\"code\":\"0\",\"msg\":\"操作成功\"}",
    "retcode": 0
}
```

## 

